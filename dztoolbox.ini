[uwsgi]
env=DATABASE_URL
module = wsgi:app
http = 127.0.0.1:5000
master = true
processes = 8  # Increased for 12-core system
threads = 4    # More threads for I/O-bound operations
enable-threads = true
buffer-size = 65536
socket = dztoolbox.sock
chmod-socket = 660
vacuum = true
stats = dztoolbox_stats.sock
harakiri = 300
max-requests = 1000  # Restart workers after 1000 requests to prevent memory leaks
max-requests-delta = 100  # Add randomness to prevent thundering herd
memory-report = true  # Monitor memory usage
reload-on-rss = 512  # Restart worker if it uses more than 512MB RAM

# Performance optimizations
lazy-apps = true  # Load app once per worker
single-interpreter = true  # Better for threading
thunder-lock = true  # Prevent thundering herd on accept()

logto = dztoolbox.log

die-on-term = true
