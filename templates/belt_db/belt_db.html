<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Belt Database</title>
	<link rel="shortcut icon" href="{{ url_for('static', filename='global/img/DZ.svg') }}">

    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Handsontable CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@14.1.0/dist/handsontable.full.min.css">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename="belt_db/styles/styles.css")}}">
    <link rel="stylesheet" href="{{ url_for('static', filename="belt_db/styles/MultiSelect.css")}}">
</head>
<body>
    <div class="header">
        <h1>Belt DB - Geological Sample Database</h1>
        <p>Interactive map of Belt Supergroup detrital zircon samples and Maximum Depositional Ages</p>
    </div>

    <div class="main-container">
        <div class="actions-bar">
            <div class="action-section">
                <h3>Search & Filters</h3>
                <div class="filter-group">
                    <label>Sample Name:</label>
                    <div class="autocomplete-container">
                        <input type="text" id="sampleSearch" placeholder="Search by name..." oninput="handleSampleSearch()" autocomplete="off">
                        <div id="sampleSuggestions" class="suggestions-dropdown" style="display: none;"></div>
                    </div>
                </div>
                <div class="filter-group">
                    <label>Belt Group:</label>
                    <select id="beltGroupFilter" onchange="filterByBeltGroup()">
                        <option value="">All Groups</option>
                        <option value="Pre-Belt">Pre-Belt</option>
                        <option value="Lower Belt">Lower Belt</option>
                        <option value="Ravalli">Ravalli</option>
                        <option value="Piegan">Piegan</option>
                        <option value="Missoula">Missoula</option>
                        <option value="Lemhi Subbasin">Lemhi Subbasin</option>
                        <option value="Post-Belt">Post-Belt</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Age Search Type:</label>
                    <select id="ageSearchType" onchange="filterByAge()">
                        <option value="mda">Maximum Depositional Age</option>
                        <option value="grain">Contains Grain in Age Range</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Age Range (Ma):</label>
                    <input type="number" id="minAge" placeholder="Min age" oninput="filterByAge()" onchange="filterByAge()" value="0">
                    <input type="number" id="maxAge" placeholder="Max age" oninput="filterByAge()" onchange="filterByAge()" value="4500">
                </div>
                <button class="action-button secondary" onclick="clearFilters()">Clear All Filters</button>
            </div>

            <div class="action-section">
                <h3>Export</h3>
                <div class="filter-group">
                    <label>Select exports:</label>
                    <select id="exportSelect" data-multi-select data-select-all="false">
						<option value="tabulated-data">Tabulated Data (XLSX)</option>
                        <option value="raw-database">Raw Database (XLSX)</option>
                    </select>
                </div>
                <button class="action-button" onclick="handleMultipleExports()">Export Selected</button>
            </div>

            <div class="stats-box">
                <h4>Dataset Statistics</h4>
                <div class="stat-item">
                    <span>Total Samples:</span>
                    <span id="totalSamples">Loading...</span>
                </div>
                <div class="stat-item">
                    <span>Visible:</span>
                    <span id="visibleSamples">Loading...</span>
                </div>
                <div class="stat-item">
                    <span>Age Range:</span>
                    <span id="ageRange">Loading...</span>
                </div>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>

        <div class="info-panel">
            <h2>Sample Information</h2>
            <div class="info-content" id="sampleInfo">
                <p class="no-selection">Click on a sample marker to view details</p>
            </div>

            <div class="kde-graph-container" id="kdeGraphContainer" style="display: none;">
                <h3>Age Distribution (KDE)</h3>
                <img id="kdeGraph" alt="KDE Graph" />
            </div>

            <div class="data-table-container" id="tableContainer" style="display: none;">
                <h3 id="tableTitle">Zircon Age Data</h3>
                <div id="zirconTable"></div>
                <button class="export-button" onclick="exportSampleData()">Export Sample Data</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Handsontable JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/handsontable@14.1.0/dist/handsontable.full.min.js"></script>

    <!-- MultiSelect JavaScript -->
    <script src="{{ url_for('static', filename="belt_db/scripts/MultiSelect.js")}}"></script>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename="belt_db/scripts/app.js")}}"></script>
</body>
</html>