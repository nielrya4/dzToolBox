<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dzToolBox</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/handsontable@latest/dist/handsontable.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/handsontable@latest/dist/handsontable.full.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/shim.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='global/styles/table_list.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='global/styles/toolbars.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='editor/styles/frame.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='editor/styles/collapsible.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='editor/styles/MultiSelect.css') }}">
    <link href="https://unpkg.com/tabulator-tables@6.3.1/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.3.1/dist/js/tabulator.min.js"></script>
    <!-- Leaflet CSS and JS for Maps -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    {% include "editor/misc/font_style.html" %}
    {% include "global/head.html" %}
</head>
<body style="overflow: hidden;" class="d-flex flex-column vh-100">
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand me-3 d-flex align-items-center" href="/projects">
                <img width="40" height="40" alt="Home" src="{{ url_for('static', filename='global/img/DZ.svg') }}" class="me-2">
                dzToolBox
            </a>
            
            <ul class="nav nav-pills" id="my_tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link editor-tab active" id="spreadsheet_tab" onclick="showTab('spreadsheet')" type="button">
                        Spreadsheet
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link editor-tab" id="outputs_tab" onclick="showTab('outputs')" type="button">
                        Outputs
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link editor-tab" id="maps_tab" onclick="showTab('maps')" type="button">
                        Maps
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <div class="flex-grow-1" id="my_tab_content">
        <div class="h-100" id="spreadsheet_page" style="display: block;">
            {% include "editor/pages/data_table.html" %}
        </div>
        <div class="h-100" id="outputs_page" style="display: none;">
            {% include "editor/pages/outputs.html" %}
			<div style="overflow-y: auto; overflow-x: auto; height: calc(100vh - 140px); max-width: 100vw !important;" id="outputs_container">
				<div class="p-3">
					{% block outputs %}
						{% for output in outputs_data %}
							<div class="mb-3" style="max-width: 100%;">
								{{ output.output_data | safe }}
							</div>
						{% endfor %}
					{% endblock %}
				</div>
			</div>
        </div>
        <div class="h-100" id="maps_page" style="display: none;">
            {% include "editor/pages/maps.html" %}
        </div>
    </div>
    {% from "global/sample_select.html" import sample_select with context %}
    {% include "editor/modals/matrix_dialog.html" %}
    {% include "editor/modals/hafnium_dialog.html" %}
    {% include "editor/modals/mds_dialog.html" %}
    {% include "editor/modals/mda_dialog.html" %}
    {% include "editor/modals/distros_dialog.html" %}
    {% include "editor/modals/unmix_dialog.html" %}
    {% include "editor/modals/settings_dialog.html" %}
    {% include "editor/modals/databases_dialog.html" %}
    {% include "editor/modals/export_spreadsheet_dialog.html" %}
    {% include "editor/modals/import_data_dialog.html" %}
    {% include "editor/spinners/new_output_spinner.html" %}
    {% include "editor/spinners/clear_outputs_spinner.html" %}
    {% include "editor/spinners/delete_output_spinner.html" %}
    {% include "editor/spinners/get_settings_spinner.html" %}
    {% include "editor/spinners/update_settings_spinner.html" %}
	<script src="{{ url_for('static', filename='editor/scripts/collapsible.js')}}"></script>
    <script src="{{ url_for('static', filename='editor/scripts/MultiSelect.js')}}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>
    
    <script>
    // Simple tab switching function
    function showTab(tabName) {
        // Hide all tab pages
        const spreadsheetPage = document.getElementById('spreadsheet_page');
        const outputsPage = document.getElementById('outputs_page');
        const mapsPage = document.getElementById('maps_page');
        
        if (spreadsheetPage) spreadsheetPage.style.display = 'none';
        if (outputsPage) outputsPage.style.display = 'none';
        if (mapsPage) mapsPage.style.display = 'none';
        
        // Remove active class from all tab buttons
        document.getElementById('spreadsheet_tab').classList.remove('active');
        document.getElementById('outputs_tab').classList.remove('active');
        document.getElementById('maps_tab').classList.remove('active');
        
        // Show selected tab and activate button
        if (tabName === 'spreadsheet') {
            if (spreadsheetPage) spreadsheetPage.style.display = 'block';
            document.getElementById('spreadsheet_tab').classList.add('active');
        } else if (tabName === 'outputs') {
            if (outputsPage) outputsPage.style.display = 'block';
            document.getElementById('outputs_tab').classList.add('active');
        } else if (tabName === 'maps') {
            if (mapsPage) mapsPage.style.display = 'block';
            document.getElementById('maps_tab').classList.add('active');

            // Trigger map initialization after tab is shown
            setTimeout(function() {
                if (typeof initializeMap === 'function') {
                    initializeMap();
                }
            }, 100);
        }
    }
	document.addEventListener('DOMContentLoaded', function() {
        console.log('Editor page loaded - new tab system');
        showTab('spreadsheet'); // Default to spreadsheet
    });
    </script>
</body>
</html>
